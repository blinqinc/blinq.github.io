import{r as o,d as T,u as q,a as A,H as j,M as p,i as M,O as F,N as G,k as B,q as g,w as P,f as U,g as Y,t as J,j as r,h as K,b as Q}from"./index-BlIc72Jk.js";import{I as W,b as X}from"./ImageResizer-Df8cGQtA.js";const k=new Set,N=K();function Z(n){if(!k.has(n))throw new Promise((i,c)=>{const d=document.createElement("video");d.src=n,d.onloadeddata=()=>{k.add(n),i(null)},d.onerror=()=>{console.error("video loading error"),k.add(n),c(new Error("Video failed to load"))}})}function ee({className:n,videoRef:i,src:c,width:d,height:v,maxWidth:C,onError:u}){return Z(c),r.jsx("video",{className:n||void 0,controls:!0,src:c,ref:i,style:{height:v,maxWidth:C,width:d},onError:u,draggable:"false",controlsList:"nodownload",children:"Your browser does not support HTML video."})}function te(){return r.jsx("video",{src:X,style:{height:200,opacity:.2,width:200},draggable:"false"})}function re({src:n,nodeKey:i,width:c,height:d,maxWidth:v,resizable:C}){const u=o.useRef(null),[l,h,E]=T(i),[m,L]=o.useState(!1),[t]=q(),[b,V]=o.useState(null),z=o.useRef(null),[D,H]=o.useState(!1),w=A(),R=o.useCallback(s=>{const e=j();return l&&p(e)&&(s.preventDefault(),t.update(()=>{e.getNodes().forEach(a=>{M(a)&&a.remove()})})),!1},[t,l]),S=o.useCallback(s=>{const e=s;return m?!0:e.target===u.current?(e.shiftKey?h(!l):(E(),h(!0)),!0):!1},[m,l,h,E]),x=o.useCallback(s=>{t.getEditorState().read(()=>{const e=j();s.target.tagName==="IMG"&&F(e)&&e.getNodes().length===1&&t.dispatchCommand(N,s)})},[t]);o.useEffect(()=>{let s=!0;const e=t.getRootElement(),f=G(t.registerUpdateListener(({editorState:a})=>{s&&V(a.read(()=>j()))}),t.registerCommand(J,(a,y)=>(z.current=y,!1),g),t.registerCommand(Y,S,g),t.registerCommand(N,S,g),t.registerCommand(U,a=>a.target===u.current?(a.preventDefault(),!0):!1,g),t.registerCommand(P,R,g),t.registerCommand(B,R,g));return e==null||e.addEventListener("contextmenu",x),()=>{s=!1,f(),e==null||e.removeEventListener("contextmenu",x)}},[E,t,m,l,i,R,S,x,h]);const O=(s,e)=>{setTimeout(()=>{L(!1)},200),t.update(()=>{const f=Q(i);M(f)&&f.setWidthAndHeight(s,e)})},_=()=>{L(!0)},$=l&&p(b)&&!m,I=l||m;return r.jsx(o.Suspense,{fallback:null,children:r.jsxs(r.Fragment,{children:[r.jsx("div",{draggable:$,children:D?r.jsx(te,{}):r.jsx(ee,{className:I&&w?`focused ${p(b)?"draggable":""}`:null,src:n,videoRef:u,width:c,height:d,maxWidth:v,onError:()=>H(!0)})}),C&&p(b)&&I&&w&&r.jsx(W,{editor:t,imageRef:u,maxWidth:v,onResizeStart:_,onResizeEnd:O})]})})}export{te as BrokenVideo,N as RIGHT_CLICK_VIDEO_COMMAND,re as default};

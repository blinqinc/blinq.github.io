import{r as n,P as x,j as e,u as g,a as j,b as q,$ as N,N as S,c as $,Q as f,t as _,H as b,M as v,E as C,K as k}from"./index-BlIc72Jk.js";function y({equation:a,setEquation:p,inline:c},t){const i=n.useRef(null),[r,m]=n.useState(0),o=s=>{p(s.target.value);const E=s.target;E.style.height=`${E.scrollHeight}px`};return n.useEffect(()=>{const s=t==null?void 0:t.current;s&&(s.style.height=`${s.scrollHeight}px`),i.current&&m(i.current.offsetWidth)},[a]),c&&x(t)?e.jsxs("span",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{id:"hide",ref:i,style:{fontSize:"1em",opacity:0,position:"absolute",whiteSpace:"pre"},children:a}),e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),e.jsx("input",{className:"EquationEditor_inlineEditor",value:a,onChange:o,style:{width:r},ref:t}),e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):e.jsxs("div",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{className:"EquationEditor_dollarSign",children:`$$
`}),e.jsx("textarea",{className:"EquationEditor_blockEditor",value:a,onChange:s=>o(s),ref:t}),e.jsx("span",{className:"EquationEditor_dollarSign",children:`
$$`})]})}const H=n.forwardRef(y);function M({equation:a,inline:p,nodeKey:c}){const[t]=g(),i=j(),[r,m]=n.useState(a),[o,s]=n.useState(!1),E=n.useRef(null),h=n.useCallback(u=>{s(!1),t.update(()=>{const l=q(c);N(l)&&(l.setEquation(r),u&&l.selectNext(0,0))})},[t,r,c]);return n.useEffect(()=>{!o&&r!==a&&m(a)},[o,a,r]),n.useEffect(()=>{if(i)return o?S(t.registerCommand(_,u=>{const l=document.activeElement;return E.current!==l&&h(),!1},f),t.registerCommand($,u=>{const l=document.activeElement;return E.current===l?(h(!0),!0):!1},f)):t.registerUpdateListener(({editorState:u})=>{u.read(()=>{const d=b();return v(d)&&d.has(c)&&d.getNodes().length===1})&&s(!0)})},[t,c,h,o,i]),e.jsx(e.Fragment,{children:o&&i?e.jsx(H,{equation:r,setEquation:m,inline:p,ref:E}):e.jsx(C,{onError:u=>t._onError(u),fallback:null,children:e.jsx(k,{equation:r,inline:p,onClick:()=>{i&&s(!0)}})})})}export{M as default};

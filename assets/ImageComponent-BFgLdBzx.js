import{r as n,d as q,u as F,a as T,H as v,M as p,e as w,O as B,N as P,k as U,q as d,w as V,f as J,g as K,t as Q,j as a,h as W,b as X}from"./index-BlIc72Jk.js";import{I as Y,b as Z}from"./ImageResizer-Df8cGQtA.js";const k=new Set,z=W();function ee(o){if(!k.has(o))throw new Promise(g=>{const r=new Image;r.src=o,r.onload=()=>{k.add(o),g(null)},r.onerror=()=>{k.add(o)}})}function te({altText:o,className:g,imageRef:r,src:f,width:E,height:C,maxWidth:I,onError:c}){return ee(f),a.jsx("img",{className:g||void 0,src:f,alt:o,ref:r,style:{height:C,maxWidth:I,width:E},onError:c,draggable:"false"})}function se(){return a.jsx("img",{src:Z,style:{height:200,opacity:.2,width:200},draggable:"false"})}function ae({src:o,altText:g,nodeKey:r,width:f,height:E,maxWidth:C,resizable:I}){const c=n.useRef(null),[l,h,S]=q(r),[m,M]=n.useState(!1),[t]=F(),[b,D]=n.useState(null),H=n.useRef(null),[_,$]=n.useState(!1),N=T(),x=n.useCallback(s=>{const e=v();return l&&p(e)&&(s.preventDefault(),t.update(()=>{e.getNodes().forEach(i=>{w(i)&&i.remove()})})),!1},[t,l]),R=n.useCallback(s=>{const e=s;return m?!0:e.target===c.current?(e.shiftKey?h(!l):(S(),h(!0)),!0):!1},[m,l,h,S]),j=n.useCallback(s=>{t.getEditorState().read(()=>{const e=v();s.target.tagName==="IMG"&&B(e)&&e.getNodes().length===1&&t.dispatchCommand(z,s)})},[t]);n.useEffect(()=>{let s=!0;const e=t.getRootElement(),u=P(t.registerUpdateListener(({editorState:i})=>{s&&D(i.read(()=>v()))}),t.registerCommand(Q,(i,O)=>(H.current=O,!1),d),t.registerCommand(K,R,d),t.registerCommand(z,R,d),t.registerCommand(J,i=>i.target===c.current?(i.preventDefault(),!0):!1,d),t.registerCommand(V,x,d),t.registerCommand(U,x,d));return e==null||e.addEventListener("contextmenu",j),()=>{s=!1,u(),e==null||e.removeEventListener("contextmenu",j)}},[S,t,m,l,r,x,R,j,h]);const y=(s,e)=>{setTimeout(()=>{M(!1)},200),t.update(()=>{const u=X(r);w(u)&&u.setWidthAndHeight(s,e)})},A=()=>{M(!0)},G=l&&p(b)&&!m,L=l||m;return a.jsx(n.Suspense,{fallback:null,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{draggable:G,children:_?a.jsx(se,{}):a.jsx(te,{className:L&&N?`focused ${p(b)?"draggable":""}`:null,src:o,altText:g,imageRef:c,width:f,height:E,maxWidth:C,onError:()=>$(!0)})}),I&&p(b)&&L&&N&&a.jsx(Y,{editor:t,imageRef:c,maxWidth:C,onResizeStart:A,onResizeEnd:y})]})})}export{se as BrokenImage,z as RIGHT_CLICK_IMAGE_COMMAND,ae as default};
